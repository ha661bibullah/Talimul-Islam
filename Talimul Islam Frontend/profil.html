<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</title>
</head>
<body>























<style>
    .main-container {
        max-width: 1000px;
        margin: 20px auto;
        width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
    }

    .profile-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 20px;
    }

    .profile-sidebar {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        height: fit-content;
    }

    .profile-picture {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background-color: #e5e7eb;
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }

    .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-picture-placeholder {
        font-size: 60px;
        color: #9ca3af;
    }

    .edit-photo {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0,0,0,0.6);
        color: white;
        text-align: center;
        padding: 8px 0;
        cursor: pointer;
        font-size: 14px;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .profile-picture:hover .edit-photo {
        opacity: 1;
    }

    .profile-info {
        text-align: center;
        margin-bottom: 20px;
    }

    .profile-name {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .profile-email {
        color: #6b7280;
        font-size: 15px;
    }

    .profile-status {
        padding: 5px 15px;
        background-color: #ecfdf5;
        color: #047857;
        border-radius: 15px;
        font-size: 14px;
        display: inline-block;
        margin-top: 10px;
    }

    .main-content {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 25px;
    }

    .section-title {
        font-size: 18px;
        margin-bottom: 20px;
        color: #374151;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .edit-btn {
        background-color: #f3f4f6;
        color: #374151;
        border: none;
        padding: 5px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
    }

    .edit-btn:hover {
        background-color: #e5e7eb;
    }

    .profile-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .detail-item {
        margin-bottom: 20px;
    }

    .detail-label {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 5px;
    }

    .detail-value {
        font-size: 16px;
        color: #111827;
    }

    .form-group {
        margin-bottom: 15px;
        text-align: left;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-size: 15px;
        font-weight: bold;
        color: #333;
    }

    input, select, textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 15px;
        transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #6A35F2;
    }

    .button {
        background-color: #6A35F2;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 12px 20px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: opacity 0.3s;
        opacity: 0.9;
    }

    .button:hover {
        opacity: 1;
    }

    .cancel-btn {
        background-color: #f3f4f6;
        color: #374151;
        margin-right: 10px;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
    }

    .file-input {
        display: none;
    }

    .password-container {
        position: relative;
    }

    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        font-size: 14px;
    }

    .edit-password-link {
        color: #6A35F2;
        text-decoration: none;
        font-size: 14px;
        cursor: pointer;
    }

    .edit-password-link:hover {
        text-decoration: underline;
    }

    .modal-overlay0 {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        display: none;
    }

    .modal0 {
        background-color: white;
        border-radius: 10px;
        padding: 25px;
        width: 100%;
        max-width: 450px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .modal-title {
        font-size: 20px;
        font-weight: bold;
        color: #374151;
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        color: #9ca3af;
    }

    .error-message {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }

    .show-error {
        display: block;
    }

    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        display: none;
    }
    
    .loading-spinner {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
        display: none;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #6A35F2;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive settings */
    @media (max-width: 768px) {
        .profile-container {
            grid-template-columns: 1fr;
        }
        
        .profile-picture {
            width: 120px;
            height: 120px;
        }
        
        .profile-details {
            grid-template-columns: 1fr;
        }
    }
</style>


<div class="main-container">
    <div class="profile-container">
        <div class="profile-sidebar">
            <div class="profile-picture" id="profilePicture">
                <div class="profile-picture-placeholder" id="profileImagePlaceholder">
                    <span>üë§</span>
                </div>
                <img id="profileImage" style="display: none;" alt="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø">
                <div class="edit-photo" id="editPhotoBtn">‡¶õ‡¶¨‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                <input type="file" id="profilePictureInput" class="file-input" accept="image/*">
            </div>
            
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ</h2>
                <p class="profile-email" id="profileEmail">example@email.com</p>
                <div class="profile-status">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- View Mode -->
            <div id="viewModeSection">
                <div class="section-title">
                    <h3>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø</h3>
                    <button class="edit-btn" id="editProfileBtn">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                </div>
                
                <div class="profile-details">
                    <div class="detail-item">
                        <div class="detail-label">‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ</div>
                        <div class="detail-value" id="viewFullName">-</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</div>
                        <div class="detail-value" id="viewEmail">-</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</div>
                        <div class="detail-value" id="viewPhone">-</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</div>
                        <div class="detail-value" id="viewBirthday">-</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶≤‡¶ø‡¶ô‡ßç‡¶ó</div>
                        <div class="detail-value" id="viewGender">-</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</div>
                        <div class="detail-value" id="viewAddress">-</div>
                    </div>
                </div>
                
                <div class="section-title" style="margin-top: 30px;">
                    <h3>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ì ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ</h3>
                    <button class="edit-btn" id="changePasswordBtn">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
                </div>
                
                <div class="profile-details">
                    <div class="detail-item">
                        <div class="detail-label">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</div>
                        <div class="detail-value">********</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
                        <div class="detail-value" id="passwordLastUpdated">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Edit Mode -->
            <div id="editModeSection" style="display: none;">
                <div class="section-title">
                    <h3>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</h3>
                </div>
                
                <form id="editProfileForm">
                    <div class="profile-details">
                        <div class="form-group">
                            <label for="editFullName">‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ</label>
                            <input type="text" id="editFullName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                            <p class="error-message" id="fullNameError">‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="editEmail">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                            <input type="email" id="editEmail" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" disabled>
                        </div>
                        
                        <div class="form-group">
                            <label for="editPhone">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                            <input type="tel" id="editPhone" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                            <p class="error-message" id="phoneError">‡¶∏‡¶†‡¶ø‡¶ï ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</p>
                        </div>
                        
                        <div class="form-group">
                            <label for="editBirthday">‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="editBirthday">
                        </div>
                        
                        <div class="form-group">
                            <label for="editGender">‡¶≤‡¶ø‡¶ô‡ßç‡¶ó</label>
                            <select id="editGender">
                                <option value="">‡¶≤‡¶ø‡¶ô‡ßç‡¶ó ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                <option value="‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑">‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑</option>
                                <option value="‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ">‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ</option>
                                <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editAddress">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
                        <textarea id="editAddress" rows="3" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="button cancel-btn" id="cancelEditBtn">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                        <button type="submit" class="button">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div class="modal-overlay0" id="passwordModal">
    <div class="modal0">
        <div class="modal-header">
            <h3 class="modal-title">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <button class="close-modal" id="closePasswordModal">&times;</button>
        </div>
        
        <div class="success-message" id="passwordSuccess">
            ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§
        </div>
        
        <form id="changePasswordForm">
            <div class="form-group">
                <label for="currentPassword">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                <div class="password-container">
                    <input type="password" id="currentPassword" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('currentPassword', 'currentPasswordToggle')" id="currentPasswordToggle">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                </div>
                <p class="error-message" id="currentPasswordError">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>
            </div>
            
            <div class="form-group">
                <label for="newPassword">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                <div class="password-container">
                    <input type="password" id="newPassword" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('newPassword', 'newPasswordToggle')" id="newPasswordToggle">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                </div>
                <p class="error-message" id="newPasswordError">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá</p>
            </div>
            
            <div class="form-group">
                <label for="confirmPassword">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <div class="password-container">
                    <input type="password" id="confirmPassword" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('confirmPassword', 'confirmPasswordToggle')" id="confirmPasswordToggle">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                </div>
                <p class="error-message" id="confirmPasswordError">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ</p>
            </div>
            
            <div class="form-actions">
                <button type="button" class="button cancel-btn" id="cancelPasswordChange">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button type="submit" class="button">‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </form>
    </div>
</div>

<!-- Loading Spinner -->
<div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
</div>





































<!-- 
<script>
    document.addEventListener('DOMContentLoaded', () => {
    // DOM elements - ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const profileImage = document.getElementById('profileImage');
    const profileImagePlaceholder = document.getElementById('profileImagePlaceholder');
    const profilePictureInput = document.getElementById('profilePictureInput');
    const editPhotoBtn = document.getElementById('editPhotoBtn');
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    
    // View profile elements - ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const viewFullName = document.getElementById('viewFullName');
    const viewEmail = document.getElementById('viewEmail');
    const viewPhone = document.getElementById('viewPhone');
    const viewBirthday = document.getElementById('viewBirthday');
    const viewGender = document.getElementById('viewGender');
    const viewAddress = document.getElementById('viewAddress');
    const passwordLastUpdated = document.getElementById('passwordLastUpdated');
    
    // Edit profile elements - ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ‡¶∞ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const editFullName = document.getElementById('editFullName');
    const editEmail = document.getElementById('editEmail');
    const editPhone = document.getElementById('editPhone');
    const editBirthday = document.getElementById('editBirthday');
    const editGender = document.getElementById('editGender');
    const editAddress = document.getElementById('editAddress');
    
    // Form error elements - ‡¶´‡¶∞‡ßç‡¶Æ ‡¶è‡¶∞‡¶∞ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const fullNameError = document.getElementById('fullNameError');
    const phoneError = document.getElementById('phoneError');
    
    // Buttons and section toggles - ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶ü‡¶ó‡¶≤ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const editProfileBtn = document.getElementById('editProfileBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const viewModeSection = document.getElementById('viewModeSection');
    const editModeSection = document.getElementById('editModeSection');
    
    // Password modal elements - ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const passwordModal = document.getElementById('passwordModal');
    const closePasswordModal = document.getElementById('closePasswordModal');
    const cancelPasswordChange = document.getElementById('cancelPasswordChange');
    const currentPassword = document.getElementById('currentPassword');
    const newPassword = document.getElementById('newPassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const currentPasswordError = document.getElementById('currentPasswordError');
    const newPasswordError = document.getElementById('newPasswordError');
    const confirmPasswordError = document.getElementById('confirmPasswordError');
    const passwordSuccess = document.getElementById('passwordSuccess');
    
    // Loading spinner - ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞
    const loadingSpinner = document.getElementById('loadingSpinner');
    
    // Forms - ‡¶´‡¶∞‡ßç‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã
    const editProfileForm = document.getElementById('editProfileForm');
    const changePasswordForm = document.getElementById('changePasswordForm');
    
    // Mock user data - ‡¶°‡ßá‡¶Æ‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶°‡¶æ‡¶ü‡¶æ
    let userData = {
        fullName: '',
        email: '',
        phone: '',
        birthday: '',
        gender: '',
        address: '',
        profilePicture: null,
        passwordLastUpdated: ''
    };
    
    // Initialize profile data - ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
    function initializeProfile() {
        // Set profile header info
        profileName.textContent = userData.fullName;
        profileEmail.textContent = userData.email;
        
        // Set view mode data
        viewFullName.textContent = userData.fullName;
        viewEmail.textContent = userData.email;
        viewPhone.textContent = userData.phone || '-';
        viewBirthday.textContent = formatDate(userData.birthday) || '-';
        viewGender.textContent = userData.gender || '-';
        viewAddress.textContent = userData.address || '-';
        passwordLastUpdated.textContent = userData.passwordLastUpdated;
        
        // Set profile image if exists
        if (userData.profilePicture) {
            profileImage.src = userData.profilePicture;
            profileImage.style.display = 'block';
            profileImagePlaceholder.style.display = 'none';
        } else {
            profileImage.style.display = 'none';
            profileImagePlaceholder.style.display = 'flex';
        }
        
        // Hide all error messages initially
        hideAllErrors();
    }
    
    // Format date to Bengali format - ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
    function formatDate(dateString) {
        if (!dateString) return null;
        
        const date = new Date(dateString);
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        
        return `${day}/${month}/${year}`;
    }
    
    // Hide all error messages - ‡¶∏‡¶ï‡¶≤ ‡¶è‡¶∞‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®
    function hideAllErrors() {
        fullNameError.style.display = 'none';
        phoneError.style.display = 'none';
        currentPasswordError.style.display = 'none';
        newPasswordError.style.display = 'none';
        confirmPasswordError.style.display = 'none';
        passwordSuccess.style.display = 'none';
    }
    
    // Show loading spinner - ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
    function showSpinner() {
        loadingSpinner.style.display = 'flex';
    }
    
    // Hide loading spinner - ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®
    function hideSpinner() {
        loadingSpinner.style.display = 'none';
    }
    
    // Toggle between view and edit modes - ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
    function toggleEditMode(showEdit) {
        if (showEdit) {
            viewModeSection.style.display = 'none';
            editModeSection.style.display = 'block';
            
            // Populate edit form with current data
            editFullName.value = userData.fullName || '';
            editEmail.value = userData.email || '';
            editPhone.value = userData.phone || '';
            editBirthday.value = userData.birthday || '';
            editGender.value = userData.gender || '';
            editAddress.value = userData.address || '';
        } else {
            viewModeSection.style.display = 'block';
            editModeSection.style.display = 'none';
            hideAllErrors();
        }
    }
    
    // Toggle password modal visibility - ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
    function togglePasswordModal(show) {
        passwordModal.style.display = show ? 'flex' : 'none';
        if (!show) {
            // Reset form when closing
            changePasswordForm.reset();
            hideAllErrors();
        }
    }
    
    // Validate phone number (Bangladesh format) - ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü)
    function validatePhone(phone) {
        // Valid formats: 01xxxxxxxxx or +8801xxxxxxxxx
        const bdPhoneRegex = /^(?:\+?88)?01[3-9]\d{8}$/;
        return bdPhoneRegex.test(phone);
    }
    
    // Handle profile picture change - ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶≤
    editPhotoBtn.addEventListener('click', () => {
        profilePictureInput.click();
    });
    
    profilePictureInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                // Update UI
                profileImage.src = event.target.result;
                profileImage.style.display = 'block';
                profileImagePlaceholder.style.display = 'none';
                
                // Update user data
                userData.profilePicture = event.target.result;
                
                // Simulate API call
                showSpinner();
                setTimeout(() => {
                    hideSpinner();
                    // Profile picture updated successful message could be shown here
                }, 1000);
            };
            
            reader.readAsDataURL(e.target.files[0]);
        }
    });
    
    // Toggle password visibility - ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
    window.togglePasswordVisibility = function(inputId, toggleBtnId) {
        const input = document.getElementById(inputId);
        const toggleBtn = document.getElementById(toggleBtnId);
        
        if (input.type === 'password') {
            input.type = 'text';
            toggleBtn.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
        } else {
            input.type = 'password';
            toggleBtn.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        }
    };
    
    // Event Listeners
    
    // Edit profile button click
    editProfileBtn.addEventListener('click', () => {
        toggleEditMode(true);
    });
    
    // Cancel edit button click
    cancelEditBtn.addEventListener('click', () => {
        toggleEditMode(false);
    });
    
    // Change password button click
    changePasswordBtn.addEventListener('click', () => {
        togglePasswordModal(true);
    });
    
    // Close password modal
    closePasswordModal.addEventListener('click', () => {
        togglePasswordModal(false);
    });
    
    // Cancel password change
    cancelPasswordChange.addEventListener('click', () => {
        togglePasswordModal(false);
    });
    
    // Profile edit form submission
    editProfileForm.addEventListener('submit', (e) => {
        e.preventDefault();
        let isValid = true;
        
        // Validate full name
        if (!editFullName.value.trim()) {
            fullNameError.style.display = 'block';
            isValid = false;
        } else {
            fullNameError.style.display = 'none';
        }
        
        // Validate phone if provided
        if (editPhone.value.trim() && !validatePhone(editPhone.value.trim())) {
            phoneError.style.display = 'block';
            isValid = false;
        } else {
            phoneError.style.display = 'none';
        }
        
        if (isValid) {
            // Update user data
            userData.fullName = editFullName.value.trim();
            userData.phone = editPhone.value.trim();
            userData.birthday = editBirthday.value;
            userData.gender = editGender.value;
            userData.address = editAddress.value.trim();
            
            // Show loading spinner for API simulation
            showSpinner();
            
            // Simulate API call
            setTimeout(() => {
                hideSpinner();
                initializeProfile(); // Update UI with new data
                toggleEditMode(false);
                
                // Could show success message here
            }, 1000);
        }
    });
    
    // Password change form submission
    changePasswordForm.addEventListener('submit', (e) => {
        e.preventDefault();
        let isValid = true;
        
        // Reset error messages
        currentPasswordError.style.display = 'none';
        newPasswordError.style.display = 'none';
        confirmPasswordError.style.display = 'none';
        
        // Validate current password
        if (!currentPassword.value) {
            currentPasswordError.style.display = 'block';
            isValid = false;
        }
        
        // Validate new password (min 6 chars)
        if (newPassword.value.length < 6) {
            newPasswordError.style.display = 'block';
            isValid = false;
        }
        
        // Validate password confirmation
        if (newPassword.value !== confirmPassword.value) {
            confirmPasswordError.style.display = 'block';
            isValid = false;
        }
        
        if (isValid) {
            // Show loading spinner
            showSpinner();
            
            // Simulate API call
            setTimeout(() => {
                hideSpinner();
                
                // Update last changed date
                const today = new Date();
                const day = today.getDate();
                const month = today.getMonth() + 1;
                const year = today.getFullYear();
                userData.passwordLastUpdated = `${year}-${month < 10 ? '0' + month : month}-${day < 10 ? '0' + day : day}`;
                
                // Show success message
                passwordSuccess.style.display = 'block';
                changePasswordForm.reset();
                
                // Update password last updated in view
                passwordLastUpdated.textContent = userData.passwordLastUpdated;
                
                // Auto close modal after 3 seconds
                setTimeout(() => {
                    togglePasswordModal(false);
                }, 3000);
            }, 1000);
        }
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
        if (e.target === passwordModal) {
            togglePasswordModal(false);
        }
    });
    
    // Initialize the profile
    initializeProfile();
});
</script> -->
<!-- <script>
    // API URL - ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ URL

const DB_API_URL_1 = 'https://t-i-a-storage-backend.onrender.com';
const DB_API_URL_2 = 'https://t-i-a-profil-storage-backend.onrender.com';

// ‡¶è‡¶ï‡¶á ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßÅ‡¶á‡¶ü‡¶ø backend-‡¶è POST ‡¶ï‡¶∞‡¶æ
const data = {
  name: "John",
  email: "john@example.com"
};

fetch(DB_API_URL_1 + '/save', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
});

fetch(DB_API_URL_2 + '/save', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
});





Promise.all([
  fetch(DB_API_URL_1 + '/users'),
  fetch(DB_API_URL_2 + '/users')
])
.then(async ([res1, res2]) => {
  const data1 = await res1.json();
  const data2 = await res2.json();

  console.log('Backend 1 data:', data1);
  console.log('Backend 2 data:', data2);
});








// Global variables
let userData = null;
let profilePictureChanged = false;
let profileImageFile = null;

// Helper functions
function showLoading() {
    document.getElementById('loadingSpinner').style.display = 'flex';
    document.body.style.cursor = 'wait';
}

function hideLoading() {
    document.getElementById('loadingSpinner').style.display = 'none';
    document.body.style.cursor = 'default';
}

// Show error with specified message
function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
    errorElement.classList.add('show-error');
}

// Hide error
function hideError(elementId) {
    document.getElementById(elementId).classList.remove('show-error');
}

// Show notification
function showNotification(message, type = 'success') {
    // ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
    const existingNotification = document.getElementById('customNotification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
    const notification = document.createElement('div');
    notification.id = 'customNotification';
    notification.className = `custom-notification ${type}`;
    
    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-message">${message}</span>
            <span class="notification-close">&times;</span>
        </div>
    `;
    
    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
    notification.style.color = 'white';
    notification.style.padding = '15px';
    notification.style.borderRadius = '5px';
    notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    notification.style.zIndex = '9999';
    notification.style.transition = 'all 0.3s ease';
    notification.style.opacity = '0';
    
    // ‡¶¨‡¶°‡¶ø‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
    document.body.appendChild(notification);
    
    // ‡¶´‡ßá‡¶° ‡¶á‡¶® ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü
    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);
    
    // ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
    const closeButton = notification.querySelector('.notification-close');
    closeButton.style.marginLeft = '15px';
    closeButton.style.cursor = 'pointer';
    closeButton.style.fontWeight = 'bold';
    
    closeButton.addEventListener('click', function() {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    });
    
    // ‡¶Ö‡¶ü‡ßã ‡¶ï‡ßç‡¶≤‡ßã‡¶ú
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 5000);
}

// Toggle password visibility
function togglePasswordVisibility(inputId, toggleId) {
    const passwordInput = document.getElementById(inputId);
    const toggleButton = document.getElementById(toggleId);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleButton.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
    } else {
        passwordInput.type = 'password';
        toggleButton.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
    }
}

// Format date to Bangla
function formatDateToBangla(dateString) {
    if (!dateString) return '-';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '-';
    
    const day = date.getDate();
    const month = date.getMonth() + 1;
    const year = date.getFullYear();
    
    return `${day}/${month}/${year}`;
}

// Check if user is logged in
async function checkLoginStatus() {
    const token = sessionStorage.getItem('authToken');
    
    if (!token) {
        // Redirect to home page if not logged in
        window.location.href = 'Talimul Islam Academi.html';
        return false;
    }
    
    try {
        // Validate token
        const response = await fetch(`${DB_API_URL}/validate-token`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            }
        });
        
        const data = await response.json();
        
        if (!data.valid) {
            // Token invalid, redirect to home
            sessionStorage.removeItem('authToken');
            sessionStorage.removeItem('currentUser');
            window.location.href = 'Talimul Islam Academi.html';
            return false;
        }
        
        return true;
    } catch (error) {
        console.error('Error validating token:', error);
        return false;
    }
}

// Fetch user data from server
async function fetchUserData() {
    showLoading();
    
    try {
        const token = sessionStorage.getItem('authToken');
        
        if (!token) {
            throw new Error('No auth token found');
        }
        
        const response = await fetch(`${DB_API_URL}/user-profile`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to fetch user data');
        }
        
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.message || 'Failed to fetch user data');
        }
        
        userData = data.user;
        return userData;
    } catch (error) {
        console.error('Error fetching user data:', error);
        showNotification('‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        return null;
    } finally {
        hideLoading();
    }
}

// Load profile picture
function loadProfilePicture(imageUrl) {
    const profileImage = document.getElementById('profileImage');
    const placeholder = document.getElementById('profileImagePlaceholder');
    
    if (imageUrl) {
        profileImage.src = imageUrl;
        profileImage.style.display = 'block';
        placeholder.style.display = 'none';
    } else {
        profileImage.style.display = 'none';
        placeholder.style.display = 'flex';
    }
}

// Fill form data for editing
function fillEditForm(user) {
    document.getElementById('editFullName').value = user.name || '';
    document.getElementById('editEmail').value = user.email || '';
    document.getElementById('editPhone').value = user.phone || '';
    document.getElementById('editBirthday').value = user.birthday || '';
    document.getElementById('editGender').value = user.gender || '';
    document.getElementById('editAddress').value = user.address || '';
}

// Update view with user data
function updateProfileView(user) {
    // Basic info
    document.getElementById('profileName').textContent = user.name || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ';
    document.getElementById('profileEmail').textContent = user.email || 'example@email.com';
    
    // Detailed info
    document.getElementById('viewFullName').textContent = user.name || '-';
    document.getElementById('viewEmail').textContent = user.email || '-';
    document.getElementById('viewPhone').textContent = user.phone || '-';
    document.getElementById('viewBirthday').textContent = formatDateToBangla(user.birthday) || '-';
    document.getElementById('viewGender').textContent = user.gender || '-';
    document.getElementById('viewAddress').textContent = user.address || '-';
    
    // Password last updated
    document.getElementById('passwordLastUpdated').textContent = 
        user.passwordLastUpdated ? formatDateToBangla(user.passwordLastUpdated) : '-';
    
    // Profile picture
    loadProfilePicture(user.profilePicture);
}

// Toggle between view and edit mode
function toggleEditMode(isEdit) {
    document.getElementById('viewModeSection').style.display = isEdit ? 'none' : 'block';
    document.getElementById('editModeSection').style.display = isEdit ? 'block' : 'none';
    
    if (isEdit && userData) {
        fillEditForm(userData);
    }
}

// Toggle password modal
function togglePasswordModal(show) {
    const modal = document.getElementById('passwordModal');
    
    if (show) {
        modal.style.display = 'flex';
        // Reset form and errors
        document.getElementById('changePasswordForm').reset();
        document.querySelectorAll('.error-message').forEach(el => {
            el.classList.remove('show-error');
        });
        document.getElementById('passwordSuccess').style.display = 'none';
    } else {
        modal.style.display = 'none';
    }
}

// Upload profile picture
async function uploadProfilePicture(file) {
    if (!file) return null;
    
    try {
        const token = sessionStorage.getItem('authToken');
        
        if (!token) {
            throw new Error('No auth token found');
        }
        
        const formData = new FormData();
        formData.append('profilePicture', file);
        
        const response = await fetch(`${DB_API_URL}/upload-profile-picture`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });
        
        if (!response.ok) {
            throw new Error('Failed to upload profile picture');
        }
        
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.message || 'Failed to upload profile picture');
        }
        
        return data.pictureUrl;
    } catch (error) {
        console.error('Error uploading profile picture:', error);
        showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        return null;
    }
}

// Initialize the page
document.addEventListener('DOMContentLoaded', async function() {
    console.log('Profile page loaded');
    
    // Check if user is logged in
    const isLoggedIn = await checkLoginStatus();
    
    if (!isLoggedIn) {
        return;
    }
    
    // Fetch user data and update UI
    const user = await fetchUserData();
    
    if (user) {
        updateProfileView(user);
    }
    
    // Set up event listeners
    
    // Edit Profile Button
    document.getElementById('editProfileBtn').addEventListener('click', function() {
        toggleEditMode(true);
    });
    
    // Cancel Edit Button
    document.getElementById('cancelEditBtn').addEventListener('click', function() {
        toggleEditMode(false);
    });
    
    // Edit Profile Form Submit
    document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Reset errors
        document.querySelectorAll('.error-message').forEach(el => {
            el.classList.remove('show-error');
        });
        
        // Get form data
        const name = document.getElementById('editFullName').value.trim();
        const phone = document.getElementById('editPhone').value.trim();
        const birthday = document.getElementById('editBirthday').value;
        const gender = document.getElementById('editGender').value;
        const address = document.getElementById('editAddress').value.trim();
        
        // Validation
        let isValid = true;
        
        if (!name) {
            showError('fullNameError', '‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
            isValid = false;
        }
        
        if (phone && !/^01[3-9]\d{8}$/.test(phone)) {
            showError('phoneError', '‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
            isValid = false;
        }
        
        if (!isValid) return;
        
        showLoading();
        
        try {
            const token = sessionStorage.getItem('authToken');
            
            if (!token) {
                throw new Error('No auth token found');
            }
            
            let profilePictureUrl = userData?.profilePicture;
            
            // Upload profile picture if changed
            if (profilePictureChanged && profileImageFile) {
                profilePictureUrl = await uploadProfilePicture(profileImageFile);
                profilePictureChanged = false;
                profileImageFile = null;
            }
            
            // Update user data
            const response = await fetch(`${DB_API_URL}/update-profile`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    name,
                    phone,
                    birthday,
                    gender,
                    address,
                    profilePicture: profilePictureUrl
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to update profile');
            }
            
            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.message || 'Failed to update profile');
            }
            
            // Update userData and UI
            userData = data.user;
            updateProfileView(userData);
            
            showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
            
            // Switch back to view mode
            toggleEditMode(false);
        } catch (error) {
            console.error('Error updating profile:', error);
            showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        } finally {
            hideLoading();
        }
    });
    
    // Profile Picture Change
    document.getElementById('editPhotoBtn').addEventListener('click', function() {
        document.getElementById('profilePictureInput').click();
    });
    
    document.getElementById('profilePictureInput').addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
            const file = e.target.files[0];
            
            // Check file type
            if (!file.type.match('image.*')) {
                showNotification('‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡ß´MB ‡¶è‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return;
            }
            
            // Preview image
            const reader = new FileReader();
            
            reader.onload = function(e) {
                document.getElementById('profileImage').src = e.target.result;
                document.getElementById('profileImage').style.display = 'block';
                document.getElementById('profileImagePlaceholder').style.display = 'none';
            }
            
            reader.readAsDataURL(file);
            
            // Save file for later upload
            profilePictureChanged = true;
            profileImageFile = file;
        }
    });
    
    // Change Password Button
    document.getElementById('changePasswordBtn').addEventListener('click', function() {
        togglePasswordModal(true);
    });
    
    // Close Password Modal
    document.getElementById('closePasswordModal').addEventListener('click', function() {
        togglePasswordModal(false);
    });
    
    // Cancel Password Change
    document.getElementById('cancelPasswordChange').addEventListener('click', function() {
        togglePasswordModal(false);
    });
    
    // Change Password Form Submit
    document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Reset errors
        document.querySelectorAll('.error-message').forEach(el => {
            el.classList.remove('show-error');
        });
        
        document.getElementById('passwordSuccess').style.display = 'none';
        
        // Get form data
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Validation
        let isValid = true;
        
        if (!currentPassword) {
            showError('currentPasswordError', '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
            isValid = false;
        }
        
        if (!newPassword || newPassword.length < 6) {
            showError('newPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
            isValid = false;
        }
        
        if (newPassword !== confirmPassword) {
            showError('confirmPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ');
            isValid = false;
        }
        
        if (!isValid) return;
        
        showLoading();
        
        try {
            const token = sessionStorage.getItem('authToken');
            
            if (!token) {
                throw new Error('No auth token found');
            }
            
            // Change password
            const response = await fetch(`${DB_API_URL}/change-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    currentPassword,
                    newPassword
                })
            });
            
            const data = await response.json();
            
            if (!response.ok || !data.success) {
                throw new Error(data.message || 'Failed to change password');
            }
            
            // Update user data if available
            if (data.user) {
                userData = data.user;
                updateProfileView(userData);
            }
            
            // Show success message
            document.getElementById('passwordSuccess').style.display = 'block';
            document.getElementById('changePasswordForm').reset();
            
            // Close modal after delay
            setTimeout(() => {
                togglePasswordModal(false);
            }, 3000);
            
        } catch (error) {
            console.error('Error changing password:', error);
            
            if (error.message.includes('current password is incorrect')) {
                showError('currentPasswordError', '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤');
            } else {
                showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
            }
        } finally {
            hideLoading();
        }
    });
    
    // Add custom notification styles
    const style = document.createElement('style');
    style.textContent = `
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .custom-notification.success {
            background-color: #4CAF50;
            color: white;
        }
        
        .custom-notification.error {
            background-color: #f44336;
            color: white;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .notification-close {
            margin-left: 15px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show-error {
            display: block;
        }
    `;
    document.head.appendChild(style);
});
</script> -->

<!-- <script>
    // API URL - ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ URL
const DB_API_URL_1 = 'https://t-i-a-storage-backend.onrender.com';
const DB_API_URL_2 = 'https://t-i-a-profil-storage-backend.onrender.com';

// Global variables
let userData = null;
let profilePictureChanged = false;
let profileImageFile = null;
let authToken = null;
let otpEmail = null;
let otpTimerInterval = null;
let otpResendCountdown = 120; // 2 minutes

// Helper functions
function showLoading() {
    document.getElementById('loadingSpinner').style.display = 'flex';
    document.body.style.cursor = 'wait';
}

function hideLoading() {
    document.getElementById('loadingSpinner').style.display = 'none';
    document.body.style.cursor = 'default';
}

// Show error with specified message
function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
    errorElement.classList.add('show-error');
}

// Hide error
function hideError(elementId) {
    document.getElementById(elementId).classList.remove('show-error');
}

// Show notification
function showNotification(message, type = 'success') {
    // ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
    const existingNotification = document.getElementById('customNotification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
    const notification = document.createElement('div');
    notification.id = 'customNotification';
    notification.className = `custom-notification ${type}`;
    
    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-message">${message}</span>
            <span class="notification-close">&times;</span>
        </div>
    `;
    
    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
    notification.style.color = 'white';
    notification.style.padding = '15px';
    notification.style.borderRadius = '5px';
    notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    notification.style.zIndex = '9999';
    notification.style.transition = 'all 0.3s ease';
    notification.style.opacity = '0';
    
    // ‡¶¨‡¶°‡¶ø‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
    document.body.appendChild(notification);
    
    // ‡¶´‡ßá‡¶° ‡¶á‡¶® ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü
    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);
    
    // ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
    const closeButton = notification.querySelector('.notification-close');
    closeButton.style.marginLeft = '15px';
    closeButton.style.cursor = 'pointer';
    closeButton.style.fontWeight = 'bold';
    
    closeButton.addEventListener('click', function() {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    });
    
    // ‡¶Ö‡¶ü‡ßã ‡¶ï‡ßç‡¶≤‡ßã‡¶ú
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 5000);
}

// Toggle password visibility
function togglePasswordVisibility(inputId, toggleId) {
    const passwordInput = document.getElementById(inputId);
    const toggleButton = document.getElementById(toggleId);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleButton.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
    } else {
        passwordInput.type = 'password';
        toggleButton.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
    }
}

// Format date to Bangla
function formatDateToBangla(dateString) {
    if (!dateString) return '-';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '-';
    
    const day = date.getDate();
    const month = date.getMonth() + 1;
    const year = date.getFullYear();
    
    return `${day}/${month}/${year}`;
}

// Check if user is logged in
async function checkLoginStatus() {
    authToken = sessionStorage.getItem('authToken');
    
    if (!authToken) {
        // Redirect to home page if not logged in
        window.location.href = 'Talimul Islam Academi.html';
        return false;
    }
    
    try {
        // ‡¶¶‡ßÅ‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/validate-token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            }),
            fetch(`${DB_API_URL_2}/validate-token`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.valid || !data2.valid) {
            // Token invalid, redirect to home
            sessionStorage.removeItem('authToken');
            sessionStorage.removeItem('currentUser');
            window.location.href = 'Talimul Islam Academi.html';
            return false;
        }
        
        return true;
    } catch (error) {
        console.error('Error validating token:', error);
        return false;
    }
}

// Fetch user data from server
async function fetchUserData() {
    showLoading();
    
    try {
        if (!authToken) {
            authToken = sessionStorage.getItem('authToken');
        }
        
        if (!authToken) {
            throw new Error('No auth token found');
        }
        
        // ‡¶¶‡ßÅ‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/user-profile`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            }),
            fetch(`${DB_API_URL_2}/user-profile`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error('Failed to fetch user data');
        }
        
        // ‡¶¶‡ßÅ‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡¶ø‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ
        userData = data1.user;
        
        // Update storage
        sessionStorage.setItem('currentUser', JSON.stringify(userData));
        
        return userData;
    } catch (error) {
        console.error('Error fetching user data:', error);
        showNotification('‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        return null;
    } finally {
        hideLoading();
    }
}

// Load profile picture
function loadProfilePicture(imageUrl) {
    const profileImage = document.getElementById('profileImage');
    const placeholder = document.getElementById('profileImagePlaceholder');
    
    if (imageUrl) {
        profileImage.src = imageUrl;
        profileImage.style.display = 'block';
        placeholder.style.display = 'none';
    } else {
        profileImage.style.display = 'none';
        placeholder.style.display = 'flex';
    }
}

// Fill form data for editing
function fillEditForm(user) {
    document.getElementById('editFullName').value = user.name || '';
    document.getElementById('editEmail').value = user.email || '';
    document.getElementById('editPhone').value = user.phone || '';
    document.getElementById('editBirthday').value = user.birthday || '';
    document.getElementById('editGender').value = user.gender || '';
    document.getElementById('editAddress').value = user.address || '';
}

// Update view with user data
function updateProfileView(user) {
    // Basic info
    document.getElementById('profileName').textContent = user.name || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ';
    document.getElementById('profileEmail').textContent = user.email || 'example@email.com';
    
    // Detailed info
    document.getElementById('viewFullName').textContent = user.name || '-';
    document.getElementById('viewEmail').textContent = user.email || '-';
    document.getElementById('viewPhone').textContent = user.phone || '-';
    document.getElementById('viewBirthday').textContent = formatDateToBangla(user.birthday) || '-';
    document.getElementById('viewGender').textContent = user.gender || '-';
    document.getElementById('viewAddress').textContent = user.address || '-';
    
    // Password last updated
    document.getElementById('passwordLastUpdated').textContent = 
        user.passwordLastUpdated ? formatDateToBangla(user.passwordLastUpdated) : '-';
    
    // Profile picture
    loadProfilePicture(user.profilePicture);
}

/* --------- LOGIN AND REGISTRATION FUNCTIONS --------- */

// Toggle between login/register forms
function toggleForm(formType) {
    // Hide all forms
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('emailCheckSection').style.display = 'none';
    document.getElementById('otpVerificationSection').style.display = 'none';
    document.getElementById('signupSection').style.display = 'none';
    document.getElementById('registrationSuccess').style.display = 'none';
    
    // Show the requested form
    switch(formType) {
        case 'login':
            document.getElementById('loginSection').style.display = 'block';
            break;
        case 'emailCheck':
            document.getElementById('emailCheckSection').style.display = 'block';
            break;
        case 'otpVerification':
            document.getElementById('otpVerificationSection').style.display = 'block';
            break;
        case 'signup':
            document.getElementById('signupSection').style.display = 'block';
            break;
    }
    
    // Reset form errors
    document.querySelectorAll('.error-message').forEach(el => {
        el.classList.remove('show-error');
    });
}

// Login function
async function loginUser(email, password) {
    showLoading();
    
    try {
        // ‡¶¶‡ßÅ‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            }),
            fetch(`${DB_API_URL_2}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error(data1.message || 'Login failed');
        }
        
        // Save token and user info
        authToken = data1.token;
        userData = data1.user;
        
        sessionStorage.setItem('authToken', authToken);
        sessionStorage.setItem('currentUser', JSON.stringify(userData));
        
        // Close login popup
        closeLoginPopup();
        
        // Refresh page or redirect
        window.location.reload();
        
        return true;
    } catch (error) {
        console.error('Login error:', error);
        return false;
    } finally {
        hideLoading();
    }
}

// Email check function for registration
async function checkEmailExists(email) {
    showLoading();
    
    try {
        // Both servers check
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/check-email`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email })
            }),
            fetch(`${DB_API_URL_2}/check-email`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email })
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        return { 
            exists: data1.exists || data2.exists,
            message: data1.message || data2.message
        };
    } catch (error) {
        console.error('Email check error:', error);
        return { 
            exists: false, 
            message: '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§' 
        };
    } finally {
        hideLoading();
    }
}

// Send OTP function
async function sendOTP(email) {
    showLoading();
    
    try {
        // Both servers send OTP
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/send-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email })
            }),
            fetch(`${DB_API_URL_2}/send-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email })
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error(data1.message || 'OTP sending failed');
        }
        
        return true;
    } catch (error) {
        console.error('OTP sending error:', error);
        return false;
    } finally {
        hideLoading();
    }
}

// Verify OTP function
async function verifyOTP(email, otp) {
    showLoading();
    
    try {
        // Both servers verify OTP
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/verify-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, otp })
            }),
            fetch(`${DB_API_URL_2}/verify-otp`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, otp })
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error(data1.message || 'OTP verification failed');
        }
        
        return true;
    } catch (error) {
        console.error('OTP verification error:', error);
        return false;
    } finally {
        hideLoading();
    }
}

// Register user function
async function registerUser(name, email, password) {
    showLoading();
    
    try {
        // Both servers register
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, password })
            }),
            fetch(`${DB_API_URL_2}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, password })
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error(data1.message || 'Registration failed');
        }
        
        return true;
    } catch (error) {
        console.error('Registration error:', error);
        return false;
    } finally {
        hideLoading();
    }
}

// Upload profile picture
async function uploadProfilePicture(file) {
    if (!file) return null;
    
    try {
        if (!authToken) {
            authToken = sessionStorage.getItem('authToken');
        }
        
        if (!authToken) {
            throw new Error('No auth token found');
        }
        
        const formData = new FormData();
        formData.append('profilePicture', file);
        
        // Both servers upload
        const responses = await Promise.all([
            fetch(`${DB_API_URL_1}/upload-profile-picture`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            }),
            fetch(`${DB_API_URL_2}/upload-profile-picture`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            })
        ]);
        
        const data1 = await responses[0].json();
        const data2 = await responses[1].json();
        
        if (!data1.success || !data2.success) {
            throw new Error(data1.message || 'Failed to upload profile picture');
        }
        
        return data1.pictureUrl;
    } catch (error) {
        console.error('Error uploading profile picture:', error);
        showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        return null;
    }
}

// OTP timer function
function startOtpTimer() {
    clearInterval(otpTimerInterval);
    otpResendCountdown = 120;
    
    const resendButton = document.getElementById('resendOtp');
    const timerElement = document.getElementById('timer');
    
    resendButton.disabled = true;
    
    otpTimerInterval = setInterval(() => {
        otpResendCountdown--;
        
        const minutes = Math.floor(otpResendCountdown / 60);
        const seconds = otpResendCountdown % 60;
        
        timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (otpResendCountdown <= 0) {
            clearInterval(otpTimerInterval);
            resendButton.disabled = false;
        }
    }, 1000);
}

// Show success modal
function showSuccessModal() {
    document.getElementById('successModal').style.display = 'flex';
}

// Close success modal
function closeModal() {
    document.getElementById('successModal').style.display = 'none';
    toggleForm('login');
    document.getElementById('registrationSuccess').style.display = 'block';
}

// Close login popup
function closeLoginPopup() {
    document.querySelector('.login-popup').style.display = 'none';
}

// Handle OTP input auto-focus
function setupOtpInputs() {
    const otpInputs = document.querySelectorAll('.otp-digit');
    
    otpInputs.forEach((input, index) => {
        input.addEventListener('input', function() {
            if (this.value.length === 1) {
                if (index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }
            }
        });
        
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' && this.value.length === 0) {
                if (index > 0) {
                    otpInputs[index - 1].focus();
                }
            }
        });
    });
}

/* --------- EVENT LISTENERS FOR PROFILE PAGE --------- */
document.addEventListener('DOMContentLoaded', async function() {
    const isProfilePage = document.getElementById('profilePage') !== null;
    const isLoginPopupPresent = document.querySelector('.login-popup') !== null;
    
    // Initialize appropriate page
    if (isProfilePage) {
        initializeProfilePage();
    }
    
    if (isLoginPopupPresent) {
        initializeLoginPopup();
    }
});

// Profile page initialization
async function initializeProfilePage() {
    console.log('Profile page loaded');
    
    // Check if user is logged in
    const isLoggedIn = await checkLoginStatus();
    
    if (!isLoggedIn) {
        return;
    }
    
    // Fetch user data and update UI
    const user = await fetchUserData();
    
    if (user) {
        updateProfileView(user);
    }
}
    // Set up event listeners
    
    // Edit Profile Button
    document.getElementById('editProfileBtn').addEventListener('click', function() {
        toggleEditMode(true);
    });
    
    // Cancel Edit Button
    document.getElementById('cancelEditBtn').addEventListener('click', function() {
        toggleEditMode(false);
    });
    
    // Edit Profile Form Submit
    document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Reset errors
        document.querySelectorAll('.error-message').forEach(el => {
            el.classList.remove('show-error');
        });
        
        // Get form data
        const name = document.getElementById('editFullName').value.trim();
        const phone = document.getElementById('editPhone').value.trim();
        const birthday = document.getElementById('editBirthday').value;
        const gender = document.getElementById('editGender').value;
        const address = document.getElementById('editAddress').value.trim();
        
        // Validation
        let isValid = true;
        
        if (!name) {
            showError('fullNameError', '‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
            isValid = false;
        }
        
        if (phone && !/^01[3-9]\d{8}$/.test(phone)) {
            showError('phoneError', '‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
            isValid = false;
        }
        
        if (!isValid) return;
        
        showLoading();
        
        try {
            if (!authToken) {
                authToken = sessionStorage.getItem('authToken');
            }
            
            if (!authToken) {
                throw new Error('No auth token found');
            }
            
            let profilePictureUrl = userData?.profilePicture;
            
            // Upload profile picture if changed
            if (profilePictureChanged && profileImageFile) {
                profilePictureUrl = await uploadProfilePicture(profileImageFile);
                profilePictureChanged = false;
                profileImageFile = null;
            }
            
            // Update user data on both servers
            const responses = await Promise.all([
                fetch(`${DB_API_URL_1}/update-profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name,
                        phone,
                        birthday,
                        gender,
                        address,
                        profilePicture: profilePictureUrl
                    })
                }),
                fetch(`${DB_API_URL_2}/update-profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name,
                        phone,
                        birthday,
                        gender,
                        address,
                        profilePicture: profilePictureUrl
                    })
                })
            ]);
            
            const data1 = await responses[0].json();
            const data2 = await responses[1].json();
            
            if (!data1.success || !data2.success) {
                throw new Error(data1.message || 'Failed to update profile');
            }
            
            // Update userData and UI
            userData = data1.user;
            updateProfileView(userData);
            
            // Update storage
            sessionStorage.setItem('currentUser', JSON.stringify(userData));
            
            showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
            
            // Switch back to view mode
            toggleEditMode(false);
        } catch (error) {
            console.error('Error updating profile:', error);
            showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        } finally {
            hideLoading();
        }
    });
    
    // Profile Picture Change
    document.getElementById('editPhotoBtn').addEventListener('click', function() {
        document.getElementById('profilePictureInput').click();
    });
    
    document.getElementById('profilePictureInput').addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
            const file = e.target.files[0];
            
            // Check file type
            if (!file.type.match('image.*')) {
                showNotification('‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡ß´MB ‡¶è‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return;
            }
            
            // Preview image
            const reader = new FileReader();
            
            reader.onload = function(e) {
                document.getElementById('profileImage').src = e.target.result;
                document.getElementById('profileImage').style.display = 'block';
                document.getElementById('profileImagePlaceholder').style.display = 'none';
            }
            
            reader.readAsDataURL(file);
            
            // Save file for later upload
            profilePictureChanged = true;
            profileImageFile = file;
        }
    });
    
    // Change Password Button
    document.getElementById('changePasswordBtn').addEventListener('click', function() {
        togglePasswordModal(true);
    });
    
    // Close Password Modal
    document.getElementById('closePasswordModal').addEventListener('click', function() {
        togglePasswordModal(false);
    });
    
    // Cancel Password Change
    document.getElementById('cancelPasswordChange').addEventListener('click', function() {
        togglePasswordModal(false);
    });
    
    // Change Password Form Submit
    document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
    });
        
    
        // Reset errors
        document.querySelectorAll('.error-message').forEach(el => {
            el.classList.remove('show-error');
        });
        
        document.getElementById('passwordSuccess').style.display = 'none';
    
        // Get form data
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Validation
        let isValid = true;
        
        if (!currentPassword) {
            showError('currentPasswordError', '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
            isValid = false;
        }
        
        if (!newPassword || newPassword.length < 6) {
            showError('newPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
            isValid = false;
        }
        
        if (newPassword !== confirmPassword) {
            showError('confirmPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ');
            isValid = false;
        }
        
        if (!isValid) return;
        
        showLoading();
        try {
    // authToken ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá sessionStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡¶®
    if (!authToken) {
        authToken = sessionStorage.getItem('authToken');
    }

    // ‡¶Ø‡¶¶‡¶ø authToken ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶è‡¶∞‡¶∞ ‡¶¶‡¶ø‡¶®
    if (!authToken) {
        throw new Error('No auth token found');
    }

    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá authToken ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
    console.log('Auth Token:', authToken);

} catch (error) {
    console.error('Authentication error:', error.message);
}
 
    
    // Change password on both servers
    const responses = await Promise.all([
        fetch(`${DB_API_URL_1}/change-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                currentPassword,
                newPassword
            })
        }),
        fetch(`${DB_API_URL_2}/change-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                currentPassword,
                newPassword
            })
        })
    ]);
    
    const data1 = await responses[0].json();
    const data2 = await responses[1].json();
    
    if (!data1.success || !data2.success) {
        throw new Error(data1.message || 'Failed to change password');
    }
    
    // Update user data if available
    if (data1.user) {
        userData = data1.user;
        updateProfileView(userData);
        
        // Update storage
        sessionStorage.setItem('currentUser', JSON.stringify(userData));
    }
    
    // Show success message
    document.getElementById('passwordSuccess').style.display = 'block';
    document.getElementById('changePasswordForm').reset();
    
    // Close modal after delay
    setTimeout(() => {
        togglePasswordModal(false);
    }, 3000);



</script> -->

<!-- <script>
    // HTML ‡¶ï‡ßã‡¶°‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ UI ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶õ‡¶ø
document.addEventListener('DOMContentLoaded', function() {
    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const profilePicture = document.getElementById('profilePicture');
    const profileImagePlaceholder = document.getElementById('profileImagePlaceholder');
    const profileImage = document.getElementById('profileImage');
    const editPhotoBtn = document.getElementById('editPhotoBtn');
    const profilePictureInput = document.getElementById('profilePictureInput');
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    
    // ‡¶≠‡¶ø‡¶â ‡¶Æ‡ßã‡¶° ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const viewModeSection = document.getElementById('viewModeSection');
    const viewFullName = document.getElementById('viewFullName');
    const viewEmail = document.getElementById('viewEmail');
    const viewPhone = document.getElementById('viewPhone');
    const viewBirthday = document.getElementById('viewBirthday');
    const viewGender = document.getElementById('viewGender');
    const viewAddress = document.getElementById('viewAddress');
    const passwordLastUpdated = document.getElementById('passwordLastUpdated');
    
    // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const editProfileBtn = document.getElementById('editProfileBtn');
    const editModeSection = document.getElementById('editModeSection');
    const editProfileForm = document.getElementById('editProfileForm');
    const editFullName = document.getElementById('editFullName');
    const editEmail = document.getElementById('editEmail');
    const editPhone = document.getElementById('editPhone');
    const editBirthday = document.getElementById('editBirthday');
    const editGender = document.getElementById('editGender');
    const editAddress = document.getElementById('editAddress');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    
    // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const passwordModal = document.getElementById('passwordModal');
    const closePasswordModal = document.getElementById('closePasswordModal');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const currentPassword = document.getElementById('currentPassword');
    const newPassword = document.getElementById('newPassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const cancelPasswordChange = document.getElementById('cancelPasswordChange');
    const passwordSuccess = document.getElementById('passwordSuccess');
    
    // ‡¶è‡¶∞‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
    const fullNameError = document.getElementById('fullNameError');
    const phoneError = document.getElementById('phoneError');
    const currentPasswordError = document.getElementById('currentPasswordError');
    const newPasswordError = document.getElementById('newPasswordError');
    const confirmPasswordError = document.getElementById('confirmPasswordError');
    
    // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞
    const loadingSpinner = document.getElementById('loadingSpinner');
    
    // ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡¶Ü‡¶∏‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶è‡¶ü‡¶ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá)
    const userData = {
        name: '‡¶Æ‡ßã‡¶É ‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤ ‡¶ï‡¶∞‡¶ø‡¶Æ',
        email: 'abdulkarim@example.com',
        phone: '01712345678',
        birthday: '1990-05-15',
        gender: '‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑',
        address: '‡¶¨‡¶æ‡¶°‡¶º‡¶ø #‡ßß‡ß®, ‡¶∞‡ßã‡¶° #‡ß©, ‡¶¨‡ßç‡¶≤‡¶ï-‡¶è, ‡¶Æ‡¶ø‡¶∞‡¶™‡ßÅ‡¶∞-‡ßß‡ß¶, ‡¶¢‡¶æ‡¶ï‡¶æ-‡ßß‡ß®‡ßß‡ß¨',
        profileImage: null,
        passwordLastUpdated: '‡ßß‡ß¶ ‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤, ‡ß®‡ß¶‡ß®‡ß´'
    };
    
    // ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
    function loadUserData() {
        // ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡¶∞‡¶Æ‡ßá‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        profileName.textContent = userData.name;
        profileEmail.textContent = userData.email;
        
        // ‡¶≠‡¶ø‡¶â ‡¶Æ‡ßã‡¶° ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        viewFullName.textContent = userData.name;
        viewEmail.textContent = userData.email;
        viewPhone.textContent = userData.phone || '-';
        viewBirthday.textContent = formatDate(userData.birthday) || '-';
        viewGender.textContent = userData.gender || '-';
        viewAddress.textContent = userData.address || '-';
        passwordLastUpdated.textContent = userData.passwordLastUpdated;
        
        // ‡¶è‡¶°‡¶ø‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        editFullName.value = userData.name;
        editEmail.value = userData.email;
        editPhone.value = userData.phone || '';
        editBirthday.value = userData.birthday || '';
        editGender.value = userData.gender || '';
        editAddress.value = userData.address || '';
        
        // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        if (userData.profileImage) {
            profileImage.src = userData.profileImage;
            profileImage.style.display = 'block';
            profileImagePlaceholder.style.display = 'none';
        } else {
            profileImage.style.display = 'none';
            profileImagePlaceholder.style.display = 'flex';
        }
    }
    
    // ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶∞‡¶æ
    function formatDate(dateString) {
        if (!dateString) return null;
        
        const months = [
            '‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', 
            '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'
        ];
        
        const date = new Date(dateString);
        const day = date.getDate();
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${day} ${month}, ${year}`;
    }
    
    // ‡¶¨‡¶Ø‡¶º‡¶∏ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
    function isValidAge(birthdate) {
        const today = new Date();
        const birthDate = new Date(birthdate);
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        
        return age >= 13; // ‡ßß‡ß© ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá
    }
    
    // ‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
    function isValidBangladeshiPhone(phone) {
        return /^01[3-9]\d{8}$/.test(phone);
    }
    
    // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
    function showModal(modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function hideModal(modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
    function showLoading() {
        loadingSpinner.style.display = 'flex';
    }
    
    function hideLoading() {
        loadingSpinner.style.display = 'none';
    }
    
    // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶è‡¶∞‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá
    function resetErrors() {
        fullNameError.style.display = 'none';
        phoneError.style.display = 'none';
        currentPasswordError.style.display = 'none';
        newPasswordError.style.display = 'none';
        confirmPasswordError.style.display = 'none';
    }
    
    // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶ü‡¶ó‡¶≤
    window.togglePasswordVisibility = function(inputId, toggleBtnId) {
        const passwordInput = document.getElementById(inputId);
        const toggleBtn = document.getElementById(toggleBtnId);
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleBtn.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
        } else {
            passwordInput.type = 'password';
            toggleBtn.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        }
    };
    
    // ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü‡ßá‡¶° API ‡¶ï‡¶≤ (‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    function simulateApiCall(callback, delay = 1000) {
        showLoading();
        setTimeout(() => {
            hideLoading();
            callback();
        }, delay);
    }
    
    // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
    
    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
    editPhotoBtn.addEventListener('click', function() {
        profilePictureInput.click();
    });
    
    profilePictureInput.addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                // ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶Ü‡¶™‡¶≤‡ßã‡¶°
                showLoading();
                
                setTimeout(() => {
                    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    userData.profileImage = event.target.result;
                    profileImage.src = event.target.result;
                    profileImage.style.display = 'block';
                    profileImagePlaceholder.style.display = 'none';
                    hideLoading();
                }, 1000);
            };
            
            reader.readAsDataURL(e.target.files[0]);
        }
    });
    
    // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶ü‡¶ó‡¶≤
    editProfileBtn.addEventListener('click', function() {
        viewModeSection.style.display = 'none';
        editModeSection.style.display = 'block';
        resetErrors();
    });
    
    cancelEditBtn.addEventListener('click', function() {
        // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá
        loadUserData();
        viewModeSection.style.display = 'block';
        editModeSection.style.display = 'none';
    });
    
    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
    editProfileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        resetErrors();
        
        let isValid = true;
        
        // ‡¶®‡¶æ‡¶Æ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
        if (!editFullName.value.trim()) {
            fullNameError.style.display = 'block';
            isValid = false;
        }
        
        // ‡¶´‡ßã‡¶® ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
        if (editPhone.value.trim() && !isValidBangladeshiPhone(editPhone.value.trim())) {
            phoneError.style.display = 'block';
            isValid = false;
        }
        
        if (isValid) {
            // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            simulateApiCall(() => {
                userData.name = editFullName.value.trim();
                userData.phone = editPhone.value.trim();
                userData.birthday = editBirthday.value;
                userData.gender = editGender.value;
                userData.address = editAddress.value.trim();
                
                // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                loadUserData();
                
                // ‡¶≠‡¶ø‡¶â ‡¶Æ‡ßã‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ
                viewModeSection.style.display = 'block';
                editModeSection.style.display = 'none';
            });
        }
    });
    
    // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∏
    changePasswordBtn.addEventListener('click', function() {
        resetErrors();
        passwordSuccess.style.display = 'none';
        changePasswordForm.reset();
        showModal(passwordModal);
    });
    
    closePasswordModal.addEventListener('click', function() {
        hideModal(passwordModal);
    });
    
    cancelPasswordChange.addEventListener('click', function() {
        hideModal(passwordModal);
    });
    
    // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
    changePasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        resetErrors();
        
        let isValid = true;
        
        // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï
        if (!currentPassword.value) {
            currentPasswordError.style.display = 'block';
            isValid = false;
        }
        
        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï
        if (newPassword.value.length < 6) {
            newPasswordError.style.display = 'block';
            isValid = false;
        }
        
        // ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï
        if (newPassword.value !== confirmPassword.value) {
            confirmPasswordError.style.display = 'block';
            isValid = false;
        }
        
        if (isValid) {
            // ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            simulateApiCall(() => {
                // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
                const now = new Date();
                const day = now.getDate();
                const months = [
                    '‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', 
                    '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'
                ];
                const month = months[now.getMonth()];
                const year = now.getFullYear();
                
                userData.passwordLastUpdated = `${day} ${month}, ${year}`;
                loadUserData();
                
                // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
                changePasswordForm.reset();
                
                // ‡¶∏‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                passwordSuccess.style.display = 'block';
                
                // ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá
                setTimeout(() => {
                    hideModal(passwordModal);
                }, 3000);
            });
        }
    });
    
    // ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™
    loadUserData();
    resetErrors();
});
</script> -->

<!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Variables to track the current state
    let currentEmail = '';
    let otpTimerInterval;
    let registeredUser = null;
    
    // Initialize the registration flow
    initRegistrationFlow();
    // initProfileFunctionality();
    
    // Initialize registration flow
    function initRegistrationFlow() {
        // Show login section by default
        toggleForm('login');
        
        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Validate inputs
            let isValid = true;
            
            if (!validateEmail(email)) {
                document.getElementById('loginEmailError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('loginEmailError').style.display = 'none';
            }
            
            if (password.trim() === '') {
                document.getElementById('loginPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('loginPasswordError').style.display = 'none';
            }
            
            if (isValid) {
                // Show loading spinner
                document.getElementById('loadingSpinner').style.display = 'flex';
                
                // Send login request to server
                const formData = new FormData();
                formData.append('action', 'login');
                formData.append('email', email);
                formData.append('password', password);
                
                fetch('user_auth.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading spinner
                    document.getElementById('loadingSpinner').style.display = 'none';
                    
                    if (data.success) {
                        // Store user data in local storage
                        localStorage.setItem('currentUser', JSON.stringify(data.user));
                        
                        // Redirect to profile page
                        window.location.href = 'profile.php';
                    } else {
                        // Show error message
                        alert(data.message || '‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    }
                })
                .catch(error => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    console.error('Error:', error);
                    alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            }
        });
        
        // Handle email check form submission
        document.getElementById('emailCheckForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('checkEmail').value;
            
            // Validate email
            if (!validateEmail(email)) {
                document.getElementById('checkEmailError').style.display = 'block';
                return;
            } else {
                document.getElementById('checkEmailError').style.display = 'none';
            }
            
            // Show loading spinner
            document.getElementById('loadingSpinner').style.display = 'flex';
            
            // Send email check request to server
            const formData = new FormData();
            formData.append('action', 'check_email');
            formData.append('email', email);
            
            fetch('user_auth.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading spinner
                document.getElementById('loadingSpinner').style.display = 'none';
                
                if (data.success) {
                    // Email is available, proceed to OTP verification
                    currentEmail = email;
                    document.getElementById('userEmail').textContent = email;
                    
                    // Request OTP from server
                    requestOTP(email);
                    
                    // Show OTP verification section
                    toggleForm('otpVerification');
                    
                    // Set up OTP input behavior
                    setupOTPInputs();
                    
                    // Start the OTP timer
                    startOTPTimer();
                } else {
                    // Email already exists
                    document.getElementById('checkEmailError').textContent = data.message || '‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶Ü‡¶õ‡ßá‡•§';
                    document.getElementById('checkEmailError').style.display = 'block';
                }
            })
            .catch(error => {
                document.getElementById('loadingSpinner').style.display = 'none';
                console.error('Error:', error);
                alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            });
        });
        
        // Handle OTP verification form submission
        document.getElementById('otpVerificationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get OTP from inputs
            const otp1 = document.getElementById('otp1').value;
            const otp2 = document.getElementById('otp2').value;
            const otp3 = document.getElementById('otp3').value;
            const otp4 = document.getElementById('otp4').value;
            const otpCode = otp1 + otp2 + otp3 + otp4;
            
            // Validate OTP
            if (otpCode.length !== 4) {
                document.getElementById('otpError').style.display = 'block';
                return;
            } else {
                document.getElementById('otpError').style.display = 'none';
            }
            
            // Show loading spinner
            document.getElementById('loadingSpinner').style.display = 'flex';
            
            // Send OTP verification request to server
            const formData = new FormData();
            formData.append('action', 'verify_otp');
            formData.append('email', currentEmail);
            formData.append('otp', otpCode);
            
            fetch('user_auth.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading spinner
                document.getElementById('loadingSpinner').style.display = 'none';
                
                if (data.success) {
                    // OTP verified, proceed to registration
                    toggleForm('signup');
                    
                    // Stop the OTP timer
                    clearInterval(otpTimerInterval);
                } else {
                    // Invalid OTP
                    document.getElementById('otpError').textContent = data.message || '‡¶Ö‡¶¨‡ßà‡¶ß ‡¶Ö‡¶ü‡¶ø‡¶™‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                    document.getElementById('otpError').style.display = 'block';
                }
            })
            .catch(error => {
                document.getElementById('loadingSpinner').style.display = 'none';
                console.error('Error:', error);
                alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            });
        });
        
        // Handle signup form submission
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Validate inputs
            let isValid = true;
            
            if (name.trim() === '') {
                document.getElementById('signupNameError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('signupNameError').style.display = 'none';
            }
            
            if (password.length < 6) {
                document.getElementById('signupPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('signupPasswordError').style.display = 'none';
            }
            
            if (password !== confirmPassword) {
                document.getElementById('signupConfirmPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('signupConfirmPasswordError').style.display = 'none';
            }
            
            if (isValid) {
                // Show loading spinner
                document.getElementById('loadingSpinner').style.display = 'flex';
                
                // Send registration request to server
                const formData = new FormData();
                formData.append('action', 'register');
                formData.append('email', currentEmail);
                formData.append('name', name);
                formData.append('password', password);
                
                fetch('user_auth.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading spinner
                    document.getElementById('loadingSpinner').style.display = 'none';
                    
                    if (data.success) {
                        // Registration successful
                        registeredUser = {
                            email: currentEmail,
                            name: name
                        };
                        
                        // Show success modal
                        document.getElementById('successModal').style.display = 'flex';
                    } else {
                        // Registration failed
                        alert(data.message || '‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    }
                })
                .catch(error => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    console.error('Error:', error);
                    alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            }
        });
        
        // Handle resend OTP button click
        document.getElementById('resendOtp').addEventListener('click', function() {
            if (this.disabled) return;
            
            // Request new OTP
            requestOTP(currentEmail);
            
            // Reset timer
            startOTPTimer();
            
            // Disable button again
            this.disabled = true;
        });
    }
    
    // Initialize profile functionality
    function initProfileFunctionality() {
        // Check if we're on the profile page
        if (!document.getElementById('editProfileBtn')) {
            return;
        }
        
        // Load user data from local storage
        const userData = loadUserData();
        if (!userData) {
            // Redirect to login if no user data
            // window.location.href = 'login.php';
            return;
        }
        
        // Display user data in profile
        displayUserData(userData);
        
        // Handle edit profile button click
        document.getElementById('editProfileBtn').addEventListener('click', function() {
            toggleProfileMode('edit');
            populateEditForm(userData);
        });
        
        // Handle cancel edit button click
        document.getElementById('cancelEditBtn').addEventListener('click', function() {
            toggleProfileMode('view');
        });
        
        // Handle edit profile form submission
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = collectEditFormData();
            if (!validateEditForm(formData)) {
                return;
            }
            
            // Show loading spinner
            document.getElementById('loadingSpinner').style.display = 'flex';
            
            // Add action and user ID to form data
            formData.append('action', 'update_profile');
            formData.append('user_id', userData.id);
            
            // Send update request to server
            fetch('user_profile.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loading spinner
                document.getElementById('loadingSpinner').style.display = 'none';
                
                if (data.success) {
                    // Update user data in local storage
                    const updatedUserData = {
                        ...userData,
                        name: formData.get('name'),
                        phone: formData.get('phone'),
                        birthday: formData.get('birthday'),
                        gender: formData.get('gender'),
                        address: formData.get('address')
                    };
                    localStorage.setItem('currentUser', JSON.stringify(updatedUserData));
                    
                    // Update profile display
                    displayUserData(updatedUserData);
                    
                    // Switch back to view mode
                    toggleProfileMode('view');
                    
                    // Show success message
                    alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                } else {
                    // Update failed
                    alert(data.message || '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                }
            })
            .catch(error => {
                document.getElementById('loadingSpinner').style.display = 'none';
                console.error('Error:', error);
                alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            });
        });
        
        // Handle change password button click
        document.getElementById('changePasswordBtn').addEventListener('click', function() {
            openPasswordModal();
        });
        
        // Handle close password modal button click
        document.getElementById('closePasswordModal').addEventListener('click', function() {
            closePasswordModal();
        });
        
        // Handle cancel password change button click
        document.getElementById('cancelPasswordChange').addEventListener('click', function() {
            closePasswordModal();
        });
        
        // Handle change password form submission
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate inputs
            let isValid = true;
            
            if (currentPassword.trim() === '') {
                document.getElementById('currentPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('currentPasswordError').style.display = 'none';
            }
            
            if (newPassword.length < 6) {
                document.getElementById('newPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('newPasswordError').style.display = 'none';
            }
            
            if (newPassword !== confirmPassword) {
                document.getElementById('confirmPasswordError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('confirmPasswordError').style.display = 'none';
            }
            
            if (isValid) {
                // Show loading spinner
                document.getElementById('loadingSpinner').style.display = 'flex';
                
                // Send change password request to server
                const formData = new FormData();
                formData.append('action', 'change_password');
                formData.append('user_id', userData.id);
                formData.append('current_password', currentPassword);
                formData.append('new_password', newPassword);
                
                fetch('user_profile.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading spinner
                    document.getElementById('loadingSpinner').style.display = 'none';
                    
                    if (data.success) {
                        // Password changed successfully
                        document.getElementById('passwordSuccess').style.display = 'block';
                        document.getElementById('changePasswordForm').reset();
                        
                        // Update password last updated
                        document.getElementById('passwordLastUpdated').textContent = getCurrentDate();
                        
                        // Hide success message after 3 seconds
                        setTimeout(function() {
                            document.getElementById('passwordSuccess').style.display = 'none';
                            closePasswordModal();
                        }, 3000);
                    } else {
                        // Password change failed
                        document.getElementById('currentPasswordError').textContent = data.message || '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º‡•§';
                        document.getElementById('currentPasswordError').style.display = 'block';
                    }
                })
                .catch(error => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    console.error('Error:', error);
                    alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            }
        });
        
        // Handle profile picture change
        document.getElementById('editPhotoBtn').addEventListener('click', function() {
            document.getElementById('profilePictureInput').click();
        });
        
        document.getElementById('profilePictureInput').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const file = e.target.files[0];
                
                // Check file type and size
                if (!file.type.match('image.*')) {
                    alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    return;
                }
                
                if (file.size > 2 * 1024 * 1024) { // 2MB max
                    alert('‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú 2MB ‡¶è‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§');
                    return;
                }
                
                // Show loading spinner
                document.getElementById('loadingSpinner').style.display = 'flex';
                
                const formData = new FormData();
                formData.append('action', 'upload_profile_picture');
                formData.append('user_id', userData.id);
                formData.append('profile_picture', file);
                
                fetch('user_profile.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading spinner
                    document.getElementById('loadingSpinner').style.display = 'none';
                    
                    if (data.success) {
                        // Update profile picture
                        const profileImage = document.getElementById('profileImage');
                        profileImage.src = data.picture_url + '?t=' + new Date().getTime(); // Add timestamp to prevent caching
                        profileImage.style.display = 'block';
                        document.getElementById('profileImagePlaceholder').style.display = 'none';
                        
                        // Update user data in local storage
                        userData.profile_picture = data.picture_url;
                        localStorage.setItem('currentUser', JSON.stringify(userData));
                        
                        alert('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    } else {
                        alert(data.message || '‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    }
                })
                .catch(error => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                    console.error('Error:', error);
                    alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            }
        });
    }
    
    // Utility Functions
    
    // Toggle between login and registration forms
    function toggleForm(formType) {
        // Hide all sections
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('emailCheckSection').style.display = 'none';
        document.getElementById('otpVerificationSection').style.display = 'none';
        document.getElementById('signupSection').style.display = 'none';
        
        // Show selected section
        switch (formType) {
            case 'login':
                document.getElementById('loginSection').style.display = 'block';
                // If user just registered, show success message
                if (registeredUser) {
                    document.getElementById('registrationSuccess').style.display = 'block';
                }
                break;
            case 'emailCheck':
                document.getElementById('emailCheckSection').style.display = 'block';
                break;
            case 'otpVerification':
                document.getElementById('otpVerificationSection').style.display = 'block';
                break;
            case 'signup':
                document.getElementById('signupSection').style.display = 'block';
                break;
        }
    }
    
    // Toggle between view mode and edit mode in profile
    function toggleProfileMode(mode) {
        if (mode === 'view') {
            document.getElementById('viewModeSection').style.display = 'block';
            document.getElementById('editModeSection').style.display = 'none';
        } else {
            document.getElementById('viewModeSection').style.display = 'none';
            document.getElementById('editModeSection').style.display = 'block';
        }
    }
    
    // Request OTP from server
    function requestOTP(email) {
        // Send OTP request to server
        const formData = new FormData();
        formData.append('action', 'send_otp');
        formData.append('email', email);
        
        fetch('user_auth.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                alert(data.message || '‡¶Ö‡¶ü‡¶ø‡¶™‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });
    }
    
    // Start OTP timer
    function startOTPTimer() {
        let timerSeconds = 120; // 2 minutes
        const timerElement = document.getElementById('timer');
        const resendButton = document.getElementById('resendOtp');
        
        // Clear existing interval
        if (otpTimerInterval) {
            clearInterval(otpTimerInterval);
        }
        
        // Update timer every second
        otpTimerInterval = setInterval(function() {
            timerSeconds--;
            
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timerSeconds <= 0) {
                clearInterval(otpTimerInterval);
                resendButton.disabled = false;
            }
        }, 1000);
    }
    
    // Set up OTP input behavior
    function setupOTPInputs() {
        const otpInputs = document.querySelectorAll('.otp-digit');
        
        otpInputs.forEach((input, index) => {
            // Clear inputs
            input.value = '';
            
            // Focus first input
            if (index === 0) {
                input.focus();
            }
            
            // Handle input
            input.addEventListener('input', function() {
                // If input is filled, focus next input
                if (this.value.length === 1 && index < otpInputs.length - 1) {
                    otpInputs[index + 1].focus();
                }
            });
            
            // Handle keydown
            input.addEventListener('keydown', function(e) {
                // If backspace is pressed and input is empty, focus previous input
                if (e.key === 'Backspace' && this.value === '' && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
        });
    }
    
    // Load user data from local storage
    function loadUserData() {
        const userData = localStorage.getItem('currentUser');
        return userData ? JSON.parse(userData) : null;
    }
    
    // Display user data in profile
    function displayUserData(userData) {
        // Set profile name and email
        document.getElementById('profileName').textContent = userData.name || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ';
        document.getElementById('profileEmail').textContent = userData.email || 'example@email.com';
        
        // Set profile details
        document.getElementById('viewFullName').textContent = userData.name || '-';
        document.getElementById('viewEmail').textContent = userData.email || '-';
        document.getElementById('viewPhone').textContent = userData.phone || '-';
        document.getElementById('viewBirthday').textContent = formatDate(userData.birthday) || '-';
        document.getElementById('viewGender').textContent = userData.gender || '-';
        document.getElementById('viewAddress').textContent = userData.address || '-';
        document.getElementById('passwordLastUpdated').textContent = formatDate(userData.password_updated_at) || '-';
        
        // Set profile picture
        if (userData.profile_picture) {
            const profileImage = document.getElementById('profileImage');
            profileImage.src = userData.profile_picture;
            profileImage.style.display = 'block';
            document.getElementById('profileImagePlaceholder').style.display = 'none';
        }
    }
    
    // Populate edit form with user data
    function populateEditForm(userData) {
        document.getElementById('editFullName').value = userData.name || '';
        document.getElementById('editEmail').value = userData.email || '';
        document.getElementById('editPhone').value = userData.phone || '';
        document.getElementById('editBirthday').value = userData.birthday || '';
        document.getElementById('editGender').value = userData.gender || '';
        document.getElementById('editAddress').value = userData.address || '';
    }
    
    // Collect edit form data
    function collectEditFormData() {
        const formData = new FormData();
        formData.append('name', document.getElementById('editFullName').value);
        formData.append('phone', document.getElementById('editPhone').value);
        formData.append('birthday', document.getElementById('editBirthday').value);
        formData.append('gender', document.getElementById('editGender').value);
        formData.append('address', document.getElementById('editAddress').value);
        return formData;
    }
    
    // Validate edit form
    function validateEditForm(formData) {
        let isValid = true;
        
        // Validate name
        if (formData.get('name').trim() === '') {
            document.getElementById('fullNameError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('fullNameError').style.display = 'none';
        }
        
        // Validate phone (if provided)
        const phone = formData.get('phone').trim();
        if (phone !== '' && !validatePhone(phone)) {
            document.getElementById('phoneError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('phoneError').style.display = 'none';
        }
        
        return isValid;
    }
    
    // Open password modal
    function openPasswordModal() {
        document.getElementById('passwordModal').style.display = 'flex';
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
        document.getElementById('passwordSuccess').style.display = 'none';
        document.getElementById('currentPasswordError').style.display = 'none';
        document.getElementById('newPasswordError').style.display = 'none';
        document.getElementById('confirmPasswordError').style.display = 'none';
    }
    
    // Close password modal
    function closePasswordModal() {
        document.getElementById('passwordModal').style.display = 'none';
    }
    
    // Close modal
    window.closeModal = function() {
        document.getElementById('successModal').style.display = 'none';
        toggleForm('login');
    };
    
    // Toggle password visibility
    window.togglePasswordVisibility = function(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);
        
        if (input.type === 'password') {
            input.type = 'text';
            toggle.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
        } else {
            input.type = 'password';
            toggle.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        }
    };
    
    // Format date for display
    function formatDate(dateString) {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return dateString;
        
        return date.toLocaleDateString('bn-BD');
    }
    
    // Get current date
    function getCurrentDate() {
        return new Date().toLocaleDateString('bn-BD');
    }
    
    // Validate email
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    // Validate phone number
    function validatePhone(phone) {
        const re = /^(\+?88)?01[3-9]\d{8}$/;
        return re.test(phone);
    }
});
</script> -->

<!-- <script>
    // API ‡¶¨‡ßá‡¶∏ URL
const API_URL = 'https://t-i-a-profil-storage-backend.onrender.com';

// ‡¶≤‡¶ó‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function loginUser(email, password) {
  try {
    const response = await fetch(`${API_URL}/login`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ email, password })
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || '‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    // ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
    sessionStorage.setItem('authToken', data.token);
    sessionStorage.setItem('currentUser', JSON.stringify(data.user));
    
    return data;
  } catch (error) {
    console.error('‡¶≤‡¶ó‡¶á‡¶® ‡¶è‡¶∞‡¶∞:', error);
    throw error;
  }
}

// ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function updateProfile(profileData) {
  try {
    const token = sessionStorage.getItem('authToken');
    
    if (!token) {
      throw new Error('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßá‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    const response = await fetch(`${API_URL}/update-profile`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(profileData)
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
    sessionStorage.setItem('currentUser', JSON.stringify(data.user));
    
    return data;
  } catch (error) {
    console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶∞‡¶∞:', error);
    throw error;
  }
}

// ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function changePassword(currentPassword, newPassword) {
  try {
    const token = sessionStorage.getItem('authToken');
    
    if (!token) {
      throw new Error('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßá‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    const response = await fetch(`${API_URL}/change-password`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ currentPassword, newPassword })
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    return data;
  } catch (error) {
    console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶∞‡¶∞:', error);
    throw error;
  }
}

// ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function loadProfile() {
  try {
    const token = sessionStorage.getItem('authToken');
    
    if (!token) {
      throw new Error('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßá‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    const response = await fetch(`${API_URL}/profile`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.message || '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }
    
    // ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
    sessionStorage.setItem('currentUser', JSON.stringify(data.user));
    
    return data.user;
  } catch (error) {
    console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶è‡¶∞‡¶∞:', error);
    throw error;
  }
}
</script> -->
<!-- <script>
    // MongoDB ‡¶á‡¶®‡ßç‡¶ü‡¶ø‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶®
// ‡¶´‡ßç‡¶∞‡¶®‡ßç‡¶ü‡¶è‡¶®‡ßç‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü - ‡¶´‡ßá‡¶ö API ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨‡ßá

let currentUser = null;
const API_BASE_URL = 'https://t-i-a-profil-storage-backend.onrender.com'; // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ API ‡¶è‡¶∞ ‡¶¨‡ßá‡¶∏ URL

// Check if user is logged in by validating session with server
async function checkLogin() {
    try {
        // ‡¶∏‡ßá‡¶∂‡¶® ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡¶®
        const sessionToken = localStorage.getItem('sessionToken');
        if (!sessionToken) {
            // Redirect to login page if no session token
            window.location.href = 'login.html';
            return false;
        }
        
        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶®
        const response = await fetch(`${API_BASE_URL}/users/validate-session`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${sessionToken}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error('Invalid session');
        }
        
        const userData = await response.json();
        currentUser = userData.user;
        return true;
    } catch (error) {
        console.error('‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        // ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶≤‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ
        localStorage.removeItem('sessionToken');
        window.location.href = 'login.html?error=invalid_session';
        return false;
    }
}

// Load user profile data from server
async function loadUserProfile() {
    if (!await checkLogin()) return;
    
    try {
        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™-‡¶ü‡ßÅ-‡¶°‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶®‡ßÅ‡¶®
        const sessionToken = localStorage.getItem('sessionToken');
        const response = await fetch(`${API_BASE_URL}/users/profile`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${sessionToken}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to load profile');
        }
        
        const profileData = await response.json();
        currentUser = profileData.user;
        
        // Set sidebar profile information
        document.getElementById('profileName').textContent = currentUser.name || '‡¶Ö‡¶§‡¶ø‡¶•‡¶ø';
        document.getElementById('profileEmail').textContent = currentUser.email || '';
        
        // If there's a profile picture
        if (currentUser.profilePicture) {
            document.getElementById('profileImage').src = currentUser.profilePicture;
            document.getElementById('profileImage').style.display = 'block';
            document.getElementById('profileImagePlaceholder').style.display = 'none';
        }
        
        // Set view mode profile details
        document.getElementById('viewFullName').textContent = currentUser.name || '-';
        document.getElementById('viewEmail').textContent = currentUser.email || '-';
        document.getElementById('viewPhone').textContent = currentUser.phone || '-';
        document.getElementById('viewBirthday').textContent = formatDate(currentUser.birthday) || '-';
        document.getElementById('viewGender').textContent = currentUser.gender || '-';
        document.getElementById('viewAddress').textContent = currentUser.address || '-';
        
        // Set password last updated
        document.getElementById('passwordLastUpdated').textContent = 
            currentUser.passwordLastUpdated ? formatDate(currentUser.passwordLastUpdated) : '‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º';
            
        // Populate edit form
        document.getElementById('editFullName').value = currentUser.name || '';
        document.getElementById('editEmail').value = currentUser.email || '';
        document.getElementById('editEmail').disabled = true; // ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶Ö‡¶ï‡ßç‡¶∑‡¶Æ ‡¶ï‡¶∞‡¶æ
        document.getElementById('editPhone').value = currentUser.phone || '';
        document.getElementById('editBirthday').value = currentUser.birthday || '';
        document.getElementById('editGender').value = currentUser.gender || '';
        document.getElementById('editAddress').value = currentUser.address || '';
    } catch (error) {
        console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
    }
}

// Format date for display
function formatDate(dateString) {
    if (!dateString) return '';
    
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return '';
        
        return date.toLocaleDateString('bn-BD', {
            year: 'numeric', 
            month: 'long', 
            day: 'numeric'
        });
    } catch (error) {
        console.error('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        return '';
    }
}

// Toggle password visibility
function togglePasswordVisibility(inputId, toggleId) {
    try {
        const passwordInput = document.getElementById(inputId);
        const toggleButton = document.getElementById(toggleId);
        
        if (!passwordInput || !toggleButton) return;
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleButton.textContent = '‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®';
        } else {
            passwordInput.type = 'password';
            toggleButton.textContent = '‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        }
    } catch (error) {
        console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®‡¶§‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
    }
}

// Show loading spinner
function showLoading() {
    document.getElementById('loadingSpinner').style.display = 'flex';
}

// Hide loading spinner
function hideLoading() {
    document.getElementById('loadingSpinner').style.display = 'none';
}

// Show error message
function showError(elementId, message) {
    try {
        const errorElement = document.getElementById(elementId);
        if (!errorElement) return;
        
        errorElement.textContent = message;
        errorElement.classList.add('show-error');
    } catch (error) {
        console.error('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:', error);
    }
}

// Hide error message
function hideError(elementId) {
    try {
        const errorElement = document.getElementById(elementId);
        if (!errorElement) return;
        
        errorElement.classList.remove('show-error');
    } catch (error) {
        console.error('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:', error);
    }
}

// Show notification message
function showNotification(message, type = 'success') {
    try {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Show notification
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        // Remove notification after 3 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    } catch (error) {
        console.error('‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
    }
}

// Switch to edit mode
function enableEditMode() {
    document.getElementById('viewModeSection').style.display = 'none';
    document.getElementById('editModeSection').style.display = 'block';
}

// Switch to view mode
function enableViewMode() {
    document.getElementById('editModeSection').style.display = 'none';
    document.getElementById('viewModeSection').style.display = 'block';
}

// Open password change modal
function openPasswordModal() {
    try {
        const passwordModal = document.getElementById('passwordModal');
        const passwordSuccess = document.getElementById('passwordSuccess');
        const changePasswordForm = document.getElementById('changePasswordForm');
        
        if (!passwordModal || !passwordSuccess || !changePasswordForm) {
            console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø');
            return;
        }
        
        passwordModal.style.display = 'flex';
        passwordSuccess.style.display = 'none';
        changePasswordForm.reset();
        
        // Clear error messages
        document.querySelectorAll('#passwordModal .error-message').forEach(el => {
            el.classList.remove('show-error');
        });
    } catch (error) {
        console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ñ‡ßã‡¶≤‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
    }
}

// Close password change modal
function closePasswordModal() {
    try {
        const passwordModal = document.getElementById('passwordModal');
        if (passwordModal) {
            passwordModal.style.display = 'none';
        }
    } catch (error) {
        console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
    }
}

// Handle profile picture change
async function handleProfilePictureChange(event) {
    try {
        const file = event.target.files[0];
        if (!file) return;
        
        if (!file.type.match('image.*')) {
            showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!', 'error');
            return;
        }
        
        // Check file size (max 2MB)
        if (file.size > 2 * 1024 * 1024) {
            showNotification('‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú 2MB ‡¶è‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§', 'error');
            return;
        }
        
        // Show loading
        showLoading();
        
        // Create FormData for file upload
        const formData = new FormData();
        formData.append('profilePicture', file);
        
        // Upload to server
        const sessionToken = localStorage.getItem('sessionToken');
        const response = await fetch(`${API_BASE_URL}/users/profile-picture`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${sessionToken}`
            },
            body: formData
        });
        
        if (!response.ok) {
            throw new Error('Failed to upload profile picture');
        }
        
        const result = await response.json();
        
        // Update UI with new profile picture URL from server
        const profileImage = document.getElementById('profileImage');
        const profileImagePlaceholder = document.getElementById('profileImagePlaceholder');
        
        if (!profileImage || !profileImagePlaceholder) {
            console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø');
            return;
        }
        
        profileImage.src = result.profilePictureUrl;
        profileImage.style.display = 'block';
        profileImagePlaceholder.style.display = 'none';
        
        // Update currentUser object
        currentUser.profilePicture = result.profilePictureUrl;
        
        showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
    } catch (error) {
        console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
    } finally {
        hideLoading();
    }
}

// Validate email format
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Validate phone number format (Bangladesh)
function isValidPhone(phone) {
    const phoneRegex = /^01[3-9]\d{8}$/;
    return phoneRegex.test(phone);
}

// Logout function with confirmation
async function logout() {
    try {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
            const sessionToken = localStorage.getItem('sessionToken');
            
            // Call server to invalidate session
            await fetch(`${API_BASE_URL}/users/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${sessionToken}`,
                    'Content-Type': 'application/json'
                }
            });
            
            // Remove token from localStorage
            localStorage.removeItem('sessionToken');
            
            // Redirect to login page
            window.location.href = 'login.html';
        }
    } catch (error) {
        console.error('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        showNotification('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
        
        // If API call fails, still remove token and redirect
        localStorage.removeItem('sessionToken');
        window.location.href = 'login.html';
    }
}

// When the page loads
window.addEventListener('load', async function() {
    try {
        if (!await checkLogin()) return;
        
        await loadUserProfile();
        
        // Add event listeners
        const elements = {
            editProfileBtn: document.getElementById('editProfileBtn'),
            cancelEditBtn: document.getElementById('cancelEditBtn'),
            changePasswordBtn: document.getElementById('changePasswordBtn'),
            closePasswordModal: document.getElementById('closePasswordModal'),
            cancelPasswordChange: document.getElementById('cancelPasswordChange'),
            editPhotoBtn: document.getElementById('editPhotoBtn'),
            profilePictureInput: document.getElementById('profilePictureInput'),
            editProfileForm: document.getElementById('editProfileForm'),
            changePasswordForm: document.getElementById('changePasswordForm'),
            logoutBtn: document.getElementById('logoutBtn')
        };
        
        // Ensure all elements exist before adding event listeners
        for (const [key, element] of Object.entries(elements)) {
            if (!element) {
                console.warn(`‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø: ${key}`);
            }
        }
        
        // Add event listeners only if elements exist
        if (elements.editProfileBtn) {
            elements.editProfileBtn.addEventListener('click', enableEditMode);
        }
        
        if (elements.cancelEditBtn) {
            elements.cancelEditBtn.addEventListener('click', enableViewMode);
        }
        
        if (elements.changePasswordBtn) {
            elements.changePasswordBtn.addEventListener('click', openPasswordModal);
        }
        
        if (elements.closePasswordModal) {
            elements.closePasswordModal.addEventListener('click', closePasswordModal);
        }
        
        if (elements.cancelPasswordChange) {
            elements.cancelPasswordChange.addEventListener('click', closePasswordModal);
        }
        
        if (elements.logoutBtn) {
            elements.logoutBtn.addEventListener('click', logout);
        }
        
        // Profile picture change
        if (elements.editPhotoBtn && elements.profilePictureInput) {
            elements.editPhotoBtn.addEventListener('click', function() {
                elements.profilePictureInput.click();
            });
            
            elements.profilePictureInput.addEventListener('change', handleProfilePictureChange);
        }
        
        // Add password toggle buttons
        const passwordToggles = {
            currentPasswordToggle: 'currentPassword',
            newPasswordToggle: 'newPassword',
            confirmPasswordToggle: 'confirmPassword'
        };
        
        for (const [toggleId, inputId] of Object.entries(passwordToggles)) {
            const toggleBtn = document.getElementById(toggleId);
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => togglePasswordVisibility(inputId, toggleId));
            }
        }
        
        // Edit profile form submission
        if (elements.editProfileForm) {
            elements.editProfileForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Reset error messages
                document.querySelectorAll('#editProfileForm .error-message').forEach(el => {
                    el.classList.remove('show-error');
                });
                
                const fullName = document.getElementById('editFullName').value.trim();
                const phone = document.getElementById('editPhone').value.trim();
                const birthday = document.getElementById('editBirthday').value;
                const gender = document.getElementById('editGender').value;
                const address = document.getElementById('editAddress').value.trim();
                
                // Validation
                let isValid = true;
                
                if (!fullName) {
                    showError('fullNameError', '‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
                    isValid = false;
                }
                
                if (phone && !isValidPhone(phone)) {
                    showError('phoneError', '‡¶∏‡¶†‡¶ø‡¶ï ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                    isValid = false;
                }
                
                if (!isValid) return;
                
                // Show loading
                showLoading();
                
                try {
                    // Update user profile on server
                    const sessionToken = localStorage.getItem('sessionToken');
                    const response = await fetch(`${API_BASE_URL}/users/profile`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${sessionToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: fullName,
                            phone: phone,
                            birthday: birthday,
                            gender: gender,
                            address: address
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to update profile');
                    }
                    
                    // Reload user profile
                    await loadUserProfile();
                    
                    // Switch back to view mode
                    enableViewMode();
                    
                    // Show success notification
                    showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                } catch (error) {
                    console.error('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
                    showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
                } finally {
                    // Hide loading
                    hideLoading();
                }
            });
        }
        
        // Change password form submission
        if (elements.changePasswordForm) {
            elements.changePasswordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Reset error messages
                document.querySelectorAll('#changePasswordForm .error-message').forEach(el => {
                    el.classList.remove('show-error');
                });
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validation
                let isValid = true;
                
                if (!currentPassword) {
                    showError('currentPasswordError', '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
                    isValid = false;
                }
                
                if (!newPassword) {
                    showError('newPasswordError', '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®');
                    isValid = false;
                } else if (newPassword.length < 6) {
                    showError('newPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
                    isValid = false;
                }
                
                if (newPassword !== confirmPassword) {
                    showError('confirmPasswordError', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ');
                    isValid = false;
                }
                
                if (!isValid) return;
                
                // Show loading
                showLoading();
                
                try {
                    // Change password on server
                    const sessionToken = localStorage.getItem('sessionToken');
                    const response = await fetch(`${API_BASE_URL}/users/change-password`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${sessionToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            currentPassword: currentPassword,
                            newPassword: newPassword
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        if (errorData.error === 'INVALID_PASSWORD') {
                            showError('currentPasswordError', '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤');
                            hideLoading();
                            return;
                        }
                        throw new Error('Failed to change password');
                    }
                    
                    // Show success message
                    const passwordSuccess = document.getElementById('passwordSuccess');
                    if (passwordSuccess) {
                        passwordSuccess.style.display = 'block';
                    }
                    
                    // Reload user profile to get updated password last changed date
                    await loadUserProfile();
                    
                    // Reset form
                    elements.changePasswordForm.reset();
                    
                    // Close modal after 2 seconds
                    setTimeout(() => {
                        closePasswordModal();
                        showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    }, 2000);
                } catch (error) {
                    console.error('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
                    showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
                } finally {
                    // Hide loading
                    hideLoading();
                }
            });
        }
    } catch (error) {
        console.error('‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error);
        showNotification('‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
    }
});

// Add CSS for notification
(function addNotificationStyles() {
    const style = document.createElement('style');
    style.textContent = `
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            z-index: 9999;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background-color: #4CAF50;
        }
        
        .notification.error {
            background-color: #F44336;
        }
    `;
    document.head.appendChild(style);
})();
</script> -->




























</body>
</html>